server:
  port: 8080

spring:
  application:
    name: fairair-backend
  config:
    import: "optional:classpath:ai-config.yaml"
  
  # R2DBC Database Configuration
  # Current: H2 file-based database (persistent)
  # To switch to PostgreSQL, change to:
  #   url: r2dbc:postgresql://localhost:5432/fairair
  #   username: your_username
  #   password: your_password
  r2dbc:
    url: r2dbc:h2:file:///./data/fairair
    username: sa
    password: 
  
  # Initialize database with schema and data
  sql:
    init:
      mode: always
  
  jackson:
    serialization:
      write-dates-as-timestamps: false
    deserialization:
      fail-on-unknown-properties: false

# Fairair Configuration
fairair:
  provider: mock
  cache:
    routes-ttl: 86400
    search-ttl: 300
  mock:
    min-delay: 500
    max-delay: 1500
  ai:
    enabled: true
    project-id: ${GCP_PROJECT_ID:portfolio-476219}
    location: ${GCP_REGION:us-central1}
    model: llama-3.1-70b-instruct-maas
    temperature: 0.7
    max-tokens: 4096
    session-timeout-seconds: 1800  # 30 minutes
  security:
    jwt:
      # IMPORTANT: Override this with environment variable in production!
      # Use: FAIRAIR_SECURITY_JWT_SECRET=your-production-secret
      secret: ${JWT_SECRET:development-only-secret-change-in-production-32chars}
      access-token-expiry-seconds: 900
      refresh-token-expiry-seconds: 604800
    rate-limit:
      enabled: true
      general-requests-per-minute: 100
      sensitive-requests-per-minute: 10
    cors:
      allowed-origins:
        - http://localhost:8081
        - http://localhost:3000
        - http://127.0.0.1:8081

# Spring Boot Actuator
management:
  endpoints:
    web:
      exposure:
        include: health,info
  endpoint:
    health:
      probes:
        enabled: true
      show-details: always

# Logging - sanitized for production
logging:
  level:
    root: INFO
    com.fairair: INFO
    # Don't log sensitive security details
    org.springframework.security: WARN
  pattern:
    console: "%d{HH:mm:ss} %-5level [%logger{36}] - %msg%n"

---
spring:
  config:
    activate:
      on-profile: dev

fairair:
  security:
    rate-limit:
      enabled: false

logging:
  level:
    root: DEBUG
    com.fairair: DEBUG

---
spring:
  config:
    activate:
      on-profile: prod

fairair:
  security:
    cors:
      allowed-origins:
        - https://fairair.yousef.codes
        - https://fairair-web-1003920697803.us-central1.run.app

logging:
  level:
    root: WARN
    com.fairair: INFO
